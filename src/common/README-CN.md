# DAOS Common Libraries

外部共享库中提供了所有DAOS组件之间共享的通用功能和基础结构。这包括以下功能：
- 哈希和校验和例程
- 对非阻塞操作的事件和事件队列支持
- 记录和调试基础结构
- locking原语
- 网络传输

## Task Scheduler Engine (TSE)
TSE是一个通用库，用于创建带有函数回调的通用任务，还可以选择在这些任务之间添加依赖关系，并将它们安排在引擎中进行调度，该引擎将按照插入它们的依赖关系图确定的顺序执行这些任务。任务依赖图是调度程序的组成部分，它允许用户创建多个任务并以非阻塞方式进行它们。

TSE不是特定于DAOS的，而是曾经是DAOS核心的一部分，后来作为独立的API被提取到通用src中。该API是通用的，并且允许在没有任何DAOS特定功能的情况下在引擎中创建任务。 DAOS库确实提供了在TSE之上构建的任务API。有关更多信息，请参见[here]（/ src / client / api / README.md）。此外，DAOS在内部使用TSE跟踪和处理与该API事件相关联的所有API任务，在某些情况下，还计划与单个API任务相对应的多个进行中的“子”任务，并添加对该任务的依赖性以进行跟踪所有这些inflight的“子级”任务。一个示例是DAOS库中的Array API，并且使用`多个副本更新对象`。

### Scheduler API

调度程序API允许用户创建通用调度程序并向其添加任务。在创建调度程序时，用户可以注册一个完成回调，以在调度程序完成时调用。

添加到调度程序中的任务不会自行执行。`必须明确调用调度程序上的进度函数（daos_sched_progress），以使引擎中的任务取得进展`。用户可以偶尔在其程序中调用此进度函数，也可以派生一个线程来重复调用进度函数。

### Task API

任务API允许创建具有通用主体功能的task，并将其添加到调度程序中。在计划程序中创建任务后，除非用户显示调用任务调度方法，否则实际上不会计划运行该任务，除非它是任务依赖关系图的一部分，在创建任务后，用户可以注册任务的依赖。此外，用户将能够注册任务的准备和完成回调：

- 当任务准备好运行但尚未执行时，将执行Preparation Callbacks，这意味着完成创建任务所依据的依赖关系，并且计划程序已准备好计划任务。当要调度的任务需要在创建任务时不可用但在任务的依赖关系完成后才可用的信息时，此功能很有用。例如，`为任务主体功能设置一些输入参数`。

- 完成回调将在任务完成执行时执行，并且用户需要在其发生时进行更多工作或处理。一个可能有用的示例是设置在TSE之上构建的更高级别事件或请求的完成，或者在依赖项列表中跟踪多个任务的错误状态。

任务API上还有其他一些功能可以支持：

- 在任务本身上设置一些可以查询的私有数据。
- 从任务堆栈空间推送和弹出数据，而无需数据复制
- 通用任务列表

详细功能见代码 [here](/src/include/daos/tse.h)

## dRPC C API
......

